name: Java Package Publishing
on:
  workflow_dispatch:
    inputs:
      version:
        description: 'Enter the new version for the package'
        required: true
jobs:
  build:
    name: Build Reseller API
    runs-on: ubuntu-latest
    strategy:
      matrix:
        java: ['17']
    steps:
    - uses: actions/checkout@v2
    - name: Set up JDK
      uses: actions/setup-java@v2
      with:
        java-version: ${{ matrix.java }}
        distribution: 'temurin'
        cache: maven

    - name: Update Version
      run: |
        NEW_VERSION="${{ github.event.inputs.version }}"
        mvn versions:set -DnewVersion=${NEW_VERSION}
        git config --global user.email ${{secrets.ADMIN_EMAIL}}
        git config --global user.name ${{secrets.ORG_NAME}}
        git add .
        git commit -m "Bump version to ${{ github.event.inputs.version }}"
        git push https://${{secrets.WORKFLOW_TOKEN}}@github.com/ingrammicro-xvantage/xi-sdk-resellers-java main

    - name: Build with Maven
      run: mvn -B package --no-transfer-progress --file pom.xml
    
    - name: Publish Package
      run: mvn --batch-mode clean deploy
      env:
        GITHUB_TOKEN: ${{ secrets.WORKFLOW_TOKEN}}
